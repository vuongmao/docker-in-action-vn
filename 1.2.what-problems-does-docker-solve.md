# 1.2 Docker giải quyết những vấn đề gì?

Sử dụng phần mềm là sự phức tạp. Trước khi cài đặt bạn phải xem xét hệ điều hành bạn đang sử dung là gì, những tài nguyên phần mềm yêu cầu, những phần mềm khác đã được cài đặt là gì, và những phần mềm phụ thuốc khác là gì. Bạn cần quyết định cài đặt phần mềm ở đây. Sau đó bạn cần biết cài đặt nó như thế nào. Thật ngạc nhiên khi các quy trình cài đặt drastically (quyết liệt??) khác nhau như thế nào. Danh sách xem xét dài và không tha cho bạn. Cài đặt phần mềm không nhất quán (best inconsistent) và quá phức tạp.

Hầu hết các máy tính có nhiều những dụng được cài đặt vá chạy. Và hầu hết các ứng dụng có sự phụ thuộc vào những phần mềm khác. Chuyện gì xảy ra khi hai hay nhiều phần mềm bạn muốn sử dụng không làm việc tốt với nhau? THẢM HỌA. Mọi thứ trở nên phức tạp hơn khi hai hay nhiều ứng dụng chia sẻ sự phụ thuộc vào phần mềm khác.

■ Chuyện gì xảy ra nếu một ứng dụng cần nâng cấp sự phụ thuộc nhưng phần mềm khác thì không?

■ Chuyện gì xảy ra khi bạn gỡ bỏ một ứng dụng? Nó đã thực sự biến mất không?

■ Bạn có thể gở bỏ những phụ thuộc phần mềm cũ?

■ Bạn có nhớ tất cả những thay đổi bạn phải làm khi cài đặt phần mềm bạn muốn để gỡ bỏ nó ra?

Sự thật đợn giản là bạn càng sử dụng nhiều phần mềm càng có nhiều khó khăn để quản lý nó. Ngay cả nếu bạn có dành nhiều thời gian và năng lượng để tìm kiềm cài đặt và chạy những ứng dụng. Bạn có tự tin rằng về bảo mật của bạn không? Các chương trình mã nguồn mở và đóng liên tục phát hành nhưng bản cập nhật bảo mật, và nhận thức được rằng tất cả vấn đề thường là không thể. Càng chạy nhiều phần mềm, tấn công nguy cơ càng cao. 

Tất cả những vấn đề đó có thể được giải quyết với những accounting, quản lý resources, và hậu cần cẩn thận. Nhưng đó là những thứ mundane và unpleasant để đối phó. Thời gian của bạn được sử dụng tốt hơn khi bạn cố gắng cài đặt, cập nhật và xuất bản. Những người xây dựng ra DOCKER đã nhận ra điều đó và cảm ơn đến sự chăm chỉ của họ bạn có thể lượt qua các giải pháp với nỗ lực tối thiểu hầu như không tốn thời gian nhiều.

Nó có thể là hầu hết những vấn đề dường như được chấp nhận ngày hôm nay. Có lẽ họ cảm thấy tầm thường bở vì bạn đã từng sử dụng chúng. Sau khi đọc cách DOCKER làm cho những vấn đề này được tiếp cận, bạn có thể nhận thấy sự thay đổi trong quan điềm của bạn.

## 1.2.1 Có tổ chức

Không có Docker một máy tính cuối cùng có thể trông giống như một ngăn kéo rác. 

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/1.2.1-image-1.png)

Hình 1.3 Mối quan hệ phụ thuộc của một chương trình mẫu

Những ứng dụng có tất cả các loại phụ thuộc, một vài ứng dụng phụ thuộc vào thư viện hệ thống cụ thể, những thức chung như là Sound, Networking, Graphics, và hơn thế nữa. Những cái khác phụ thuộc vào thư viện tiêu chuẩn đại diện cho ngôn ngữ viết ra chúng. Một số khác thì phụ thuộc vào ứng dụng khác, như việc các chương trình JAVA phục thuộc vào máy ảo JAVA hay một ứng dụng web có lẽ phụ thuộc vào một Database. Nó rất phổ biến cho một chương trình đang chạy yêu cầu quyền truy cập vào một sốt tài nguyên khan hiếm như Network Connection hay một File

Ngày nay, không có DOCKER, những ứng dụng được trải đều trên tất cả file hệ thống và cuối cùng tạo ra một mạng lưới lộn xộn. Hình 1.3 mô tả cách các ứng dụng ví dụ phụ thuộc và những thự viện ví dụ mà không có DOCKER.

DOCKER giữ mọi thứ được tổ chức bằng cách cô lập mọi thứ với containers và images. Hình 1.4 minh họa những ứng dụng tương tự và sự phụ thuộc của chúng đang chạy ở bên trong containers. Với những sự liên kết bị hỏng và mỗi ứng dụng được chứa đựng rõ ràng. Hiểu về hệ thống là một nhiệm vụ dễ dàng tiếp cận.

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/1.2.1-image-2.png)

Hình 1.4 Những chương trình ví dụ đang chạy bên trong container với nhân bản sự phụ thuộc của chúng

## 1.2.2 Cải thiện tính di động

Một vấn đề khác của phần mềm là kiểu phụ thuộc vào ứng dụng bao gồm một hệ điều hành cụ thể. Tính di động giữa hệ điều hành là một vấn đề chính đối với người dùng phần mềm. Mặc dù nó có thề có khả năng tương thích giữa Linux và Mac OS X, sử dụng cùng phần mềm trên Windows có thể khó khăn hơn. Làm như vậy có thể xây dựng toàn bộ phiên bản được chuyển (ported) của phần mềm. Thậm chí điều đó chỉ có thể nếu sự phụ thuộc thay thế phù hợp tồn tại cho Windows. Điều này thể hiện một nỗ lực lớn cho những người duy trì ứng dụng và thường xuyên bị bỏ qua. Không may mắn thay cho những người dùng, toàn bộ phần mềm mạnh mẽ là quá khó hoặc không thể sử dụng trên hệ thống của họ.

Hiện tại DOCKER chạy trực tiếp trên Linux và đi kèm với một máy ảo duy nhất cho môi trường OS X và Windows. Sự hội tụ này trên Linux nghĩa là phần mềm đang chạy trong một DOCKER containrs chỉ cần được viết lại một lần so với tập hợp các phụ thuộc nhất quán. Bạn có thể đã nghĩ cho chính mình, "Chờ một chút, Bạn vừa mới nói với tôi rằng DOCKER tốt hơn những máy ảo". Điều này là chính xác, nhưng chúng là những công nghệ bổ sung. Sử dụng một máy ảo để chứa một chương trình đơn lẻ là sự lãng phí. Điều này đặc biệt khi bạn đang chạy nhiều máy ảo trên cùng một máy tính. Trên OS X và Windows, DOCKER sử dụng một máy ảo duy nhất nhỏ gọn để chạy tất cả các containers. Bằng cách tiếp cận này, sự quá tải của việc chạy một máy ảo đã được giải quyết trong khi số lượng container có thể được mở rộng.

Tính di động mới này giúp người dùng theo một số cách. Đầu tiên, nó mở ra một thế giới đầy đủ của phần mềm điều đó trước đây không thể truy cập. Thứ hai, bây giờ chạy chính xác một phần mềm trên cùng một phần mềm trên bất kỳ hệ thống nào là điều khả thì. Điều đó có nghĩa desktop của bạn, môi trường phát triển của bạn, server công ty của bạn, và cloud công ty của bạn tất cả có thể chạy cùng những chương trình. Chạy những môi trường nhất quán là điều quan trọng. LÀM NHƯ THẾ GIÚP GIẢM THIỂU ĐƯỜNG CONG HỌC TẬP LIÊN QUAN ĐẾN VIỆC ÁP DỤNG CÔNG NGHỆ MỚI. Nó giúp những người phát triển phần mềm hiểu về hệ thống tốt hơn để chạy chương trình của họ. Nó có nghĩa là ít sự ngỡ ngàng hơn. Thứ ba là khi những người bảo trì phần mềm có thể tập trung vào việc viết những chương trình của họ cho một nền tảng đơn lẻ và một tập hơp các sự phục thuộc. Đây là sự tiết kiệm thời gian cực kỳ lớn và là chiến thắng tuyệt vời cho khách hàng của họ.

Không có DOCKER hay máy ảo, tính di động thường đạt được ở cấp độ chương trình các nhân dựa trên phần mềm ở một vài công cụ chung. Ví dụ, Java để những nhà lập trình viết một chương trình duy nhất sẽ hoạt động trên một số hệ điều hành bở vì những chương trình này dựa trên một chương trình gọi là máy ảo java (JVM). Mặc dù,  đây là một cách tiếp cập đầy đủ trong khi viết phần mềm, những người khác, tại những công ty khác đã viết hầu hết các phần mềm chúng ta sử dụng. Ví dụ, có một Web Server phổ biến thôi muốn sử dụng, nhưng nó không được viết bằng ngôn ngữ Java hay một ngôn ngữ di động khác tương tự, tôi nghi ngờ rằng các tác giả đã mất thời gian để viết lại nó cho tôi. Ngoài sự thiếu sót này, thông dịch viên ngôn ngữ và những thư viện phần mềm là những thứ tạo ra những vấn đề sự phụ thuộc. DOCKER cải thiện tính di động của bất kế chương trình nào của ngôn ngữ nào đã viết ra nó, hệ điều hành đã được thiết kết cho nó, hay tình trạng của môi trường ở nơi nó chạy.

Tính di động mới này giúp người dùng theo một số cách. Đầu tiên, nó mở ra một thế giới đầy đủ của phần mềm điều đó trước đây không thể truy cập. Thứ hai, bây giờ chạy chính xác một phần mềm trên cùng một phần mềm trên bất kỳ hệ thống nào là điều khả thì. Điều đó có nghĩa desktop của bạn, môi trường phát triển của bạn, server công ty của bạn, và cloud công ty của bạn tất cả có thể chạy cùng những chương trình. Chạy những môi trường nhất quán là điều quan trọng. LÀM NHƯ THẾ GIÚP GIẢM THIỂU ĐƯỜNG CONG HỌC TẬP LIÊN QUAN ĐẾN VIỆC ÁP DỤNG CÔNG NGHỆ MỚI. Nó giúp những người phát triển phần mềm hiểu về hệ thống tốt hơn để chạy chương trình của họ. Nó có nghĩa là ít sự ngỡ ngàng hơn. Thứ ba là khi những người bảo trì phần mềm có thể tập trung vào việc viết những chương trình của họ cho một nền tảng đơn lẻ và một tập hơp các sự phục thuộc. Đây là sự tiết kiệm thời gian cực kỳ lớn và là chiến thắng tuyệt vời cho khách hàng của họ.

## 1.2.3 Bảo vệ máy tính của bạn

Hầu hết mọi thứ tôi đã đề cập cho những vấn đề từ góc nhìn của công việc với phần mềm và những lợi của việc làm như vậy từ phía bên ngoài container. Nhưng nhưng containers cũng bảo vệ chúng ta từ phần mềm chạy bên trong một container. Có đủ mọi cách để một chương trình có thể hoạt động sai hay có rủi ro bảo mật:

■ Một chương trình có thể được viết riêng bở một kẻ tấn công.

■ Những nhà phát triển Well-meaning có thể viết một chương trình với những bugs có hại.

■ Một chương trình có thể vô tình (accidentally) thực hiện tống tiến của một kẻ tấn công thông qua bugs xử lý đầu ra của nó.

Bạn bỏ nó đi bằng bất cứ cách nào, phẩn mềm đang chạy đặt bảo mật đều gây rủi ro cho máy tính của bạn. Bởi vì phần mềm đang chạy là những thứ đầy đủ cho một moáy tính, nó rất cẩn thận áp dụng giảm thiểu rủi ro thực tế.

Giống như các ô 'jail' vậy lý, mọi thứ bên trong container chỉ có thể được truy cập mọi thú có bên trong nó. Có những ngoại lên cho những quay tắc này nhưng chỉ khi người dùng tạo ra nó cách rõ ràng. Các containers giới hạn phạm vi tác động mà một chương trình có thể có đối với các chương trình đang chạy khác, Data nó có thể truy cập và tài nguyên hệ thống. Hình 1.5 minh họa sự khác nhau giữa phần mềm đang chạy bên ngoài và bên trong container.

Điều có ý nghĩa gì cho bạn hay cho doanh nghiệp của bạn là phạm vi của bất kỳ mối đe dọa bảo mật nào liên quan đến việc chạy một ứng dụng cụ thể được giới hạn trong phạm vi của chính ứng dụng. Tạo ra một ứng dụng containers mạnh mẽ rất phức tạp và là một thành phần quan trong của bất kỳ chiến lược bảo vệ chuyên sao nào. Nó thường xuyên được bỏ qua hay tiến hành một cách nửa vời.

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/1.2.3-image-1.png)

Hình 1.5 Bên trái: một chương trình độc hại với sự truy cập trực tiếp đến tài nguyên nhạy cảm. Bên phải: một chương trình đôc hại nằm bên trong một container


# 1.1 Docker là gì?

Docker không phải là một ngôn ngữ lập trình, nó không phải là một nền tảng để xây dựng phần mềm. Docker là một công cụ giúp giải quyết những vấn đề chung như Installing, Removing, Upgrading, Distributing, Trusting, and Managing sofware.

Docker là một chương trình command-line, một daemon, và một tập hơp các dịch vụ từ xa có một cách tiếp cận "logistical" để giải quyết các vấn đề chung của phần mềm và đơn giản hóa bước installing, running, publishing, và removing software. Docker đạtược những thứ này bằng cách sử dụng công nghê UNIX được gọi là **containers**

## 1.1.1 Containers

Trong lịch sử thì những hệ thống mã nguồn mở UNIX-style đã từng sử dụng thuật ngữ "jail" để mô tả một môi trường runtime được chỉnh sử cho một chương trình phòng chống sự truy cập những tài nguyên được bảo vệ. Từ năm 2005, sau release của Sun's Solaris 10 và Solaris Containers, container đã trở nên một thuật ngữ được yêu thích như một môi trường runtime. Mục đích đã được mở rộng từ sự phòng chống truy cập để bảo vệ tài nguyên đến "isolating" của một xử lý từ tất cả các tài nguyên ngoại trừ nơi được cho phép rõ ràng.

Sử dụng containers đã được thử nghiệm trong một thời gian dài. Nhưng xây dựng containers thủ công có nhiều khó khăn và hay có những bước làm không chính xác. Sự khó khăn này đã đặt ra cho họ mộ vài nghiên cứu, và những containers bị cấu hình sai đã đưa những người khác vào một cảm giác sai của bảo mật. Chúng ta cần một giải pháp cho vấn đền này, và DOCKER giúp chúng ta điều đó. Bất cứ phần mềm nào chạy với DOCKER là được chạy bên trong một container. DOCKER sử dụng sự tồn tại của container engines để cung cấp những container phù hợp theo những trải nghiệm tốt nhất. Điều này đặt bảo mật cao hơn trong tầm tay của mỗi người.

Với DOCKER, người dùng có được những containers với chi phí thấp hơn nhiều. Khi DOCKER và những container engines của nó được cải thiện. Bạn có được nhưng tính năng 'jail' mới nhất và tuyệt vời nhất. Thay vì theo đuổi sự phát triển một cách nhanh chóng và công nghệ cao của thế giới để xây dựng nhưng ứng dụng jail mạnh mẽ, bạn có thể để DOCKER giữ phần lớn trong số đó cho bạn. Nó giúp bạn tiết kiệm rất nhiều thời gian và tiền bạc và mang lại sự bình yên trong tâm hồn.

## 1.1.2 Containers không phải là ảo hóa

Không có DOCKER, những doanh nghiệp sử dụng phần mềm ảo hóa (cũng được biết như những máy ảo) để cung cấp Isolation. Máy ảo cung cấp phần cứng ào dựa vào hệ thống mã nguồn mở và những chương trình khác đã được cài đặt. Họ tốn thời gian (thường tính bằng phút) để tạo và yêu cầu chi phí tài nguyên đáng kể bởi vì chúng chạy trên một sự copy đầy đủ của một hệ thống mở thêm vào những phần mềm bạn muốn sử dụng. 

Không giống như những máy ảo, DOCKER containers không sử dụng phần cứng ảo hóa. Nhưng chương trình đang chạy bên trong DOCKER containers tương tác trực tiếp với kernel Linux. Bởi vei2 không có lớp bổ sung nào ở giữa chương trình chạy bên trong cibtauber và hệ điều hành của máy tính. Đây là một dấu hiệu đặc biệt quan trọng. DOCKER không phải là một công nghệ ảo hóa. Thay vào đó, nó giúp bạn sử dụng công nghệ container để xây dựng trong hệ điều hành của bạn.

## 1.1.3 Chạy các phần mềm bên trong các container độc lập.

Đã ghi điều này trước đó rằng container đã tồn tại trong nhiều thập kỷ. DOCKER sử dụng không gian tên Linux và cgroups, đó đã là một phần của Linux từ năm 2007. DOCKER KHÔNG CUNG CẤP CÔNG NGHỆ CONTAINER, nhưng nó làm cho container dễ sử dụng hơn. Để hiểu container làm cái gì trên một hệ thống, để đạt được điều đầu tiên của cơ sở.

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/1.1.3-image-1.png)

Hình 1.1. Một stack máy tính cơ bản đang chạy 2 chương trình được bắt đầu từ môt command line.

Chú ý rằng giao diện Command-Line, hay CLI, chạy trong cái được gọi là bộ nhớ 'User Space' giống như những chương trình khác chạy trên nền của hệ điều hành. Một cách lý tưởng nhất, các chương trình chạy bên trong 'User Space' không thể chỉnh sửa bộ nhớ kernel space. Nói một các bao quá hơn, hệ điều là giao diện giữa tất cả các chương trình người dùng và phần cứng máy tính đang chạy.

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/1.1.3-image-2.png)

Hình 1.2 Trình bày ví dụ cơ bản chạy trên một hệ thống kiến trúc máy tính cơ bản.

Bạn có thể nhìn thấy trong hình 1.2, DOCKER đang chạy nghĩa là đang chạy 2 chương trình trong 'User Space'. Chương trình đầu tiên là DOCKER DEAMON. Nếu được cài đặt đúng cách, đây là tiến trình sẽ luôn luôn được chạy. Chương trình thứ hai là DOCKER CLI. Đây là chương trình DOCKER để người dùng tương tác. Nếu bạn muốn start, stop hay install software, bạn sẽ sử dụng command bằng chương trình DOCKER.

Hình 1.2 cũng trình bày 3 containers đang chạy. Mỗi một container chạy như là một xử lý con của DOCKER DEAMON, được bao bọc bên trong một container, và quá trình chạy diễn ra biên trong không gian bộ nhớ con của chính nó của 'User Space'. Những chương trình đang chạy bên trong một container có thể chỉ truy cập vào bộ nhớ và tài nguyên của nó như một phạm vi của container.

Những container được DOCKER xây dựng là độc lập đối với 8 khía cạnh. 

Phần 1 của quyển sách này chứa đựng mỗi loại khía cạnh đó thông qua sự khám phá những tính năng của DOCKER container. Những khía cạnh đặc biệt như sau:

■ PID namespace—Process identifiers and capabilities

■ UTS namespace—Host and domain name

■ MNT namespace—File system access and structure

■ IPC namespace—Process communication over shared memory

■ NET namespace—Network access and structure

■ USR namespace—User names and identifiers

■ chroot()—Controls the location of the file system root

■ cgroups—Resource protection

Không gian tên Linux và cgroups quán xuyến đến container khi runtime. DOCKER sử dụng tập hợp công nghệ khác để cung cấp những container cho những files để thực hiện giống như vận chuyển containers (shipping containers)

## 1.1.4 Vận chuyển containers (Shipping Containers)

Bạn có thể suy nghĩ về một DOCKER container như một sự vận chuyển containner thực thế. Nó là một chiếc hộp mà ở đó bạn lưu trữ và chạy một ứng dụng và tất cả các phụ thuộc của nó. Cũng như xe cẩu, xe tải, xe lữa và tàu có thể làm việc một cách dễ dàng với việc vận chuyển containers, như DOCKER có thể run, copy, và distribute containers dễ dàng. DOCKER hoàn thành sự mơ hồ về container truyền thống bằng việc thêm vào một cách để đóng gói và phân phối phần mềm. Thành phần để đặt cho vai trò vận chuyển container (shipping container) được gọi là một IMAGE.

Một DOCKER IMAGE là một bộ các hình ảnh của tất cả những files nên có để một chương trình chạy bên trong container. Bạn có thể tạo ra nhiều container từ một IMAGE theo ý bạn. Nhưng khi bạn làm nó, những container đã được 'start' từ cùng một IMAGE không cập nhật sự thay đổi trên file hệ thống. Khi bạn phân phối phần mềm với DOCKER, bạn phân phối những IMAGE, và những máy tính nhận nó để tạo ra container từ chúng. IMAGES là những đơn vị có thể chuyển đổi trong hệ sinh thái DOCKER (DOCKER ecosystem).

DOCKER cung cấp tập hợp của thành phần cơ sở hạ tầng để đơn giản hóa việc phân phối DOCKER IMAGE. Những thành phần đã được đăng ký và đánh dấu chỉ mục. Bạn có thể sử dụng cơ sở hạ tần được cung cấp bở DOCKER Inc, hay các công ty khác, hay chính bạn một đăng ký và đánh dấu chỉ mục cách công khai.

| Phần tiếp theo                      |
| ----------------------------------- |
| [Tại sao Docker quan trọng](https://github.com/vuongmao/docker-in-action-vn/blob/master/1.3.why-is-docker-important.md#t%E1%BA%A1i-sao-docker-l%E1%BA%A1i-quan-tr%E1%BB%8Dng) |
| [Ở đâu và khi nào thì sử dụng Docker](https://github.com/vuongmao/docker-in-action-vn/blob/master/1.4.where-and-when-to-use-docker.md#%E1%BB%9F-%C4%91%C3%A2u-v%C3%A0-khi-n%C3%A0o-th%C3%AC-s%E1%BB%AD-d%E1%BB%A5ng-docker) |
| [Ví dụ Hello World](https://github.com/vuongmao/docker-in-action-vn/blob/master/1.5.example-hello-world.md#v%C3%AD-d%E1%BB%A5-hello-world) |
| [Tóm tắt chương 1](https://github.com/vuongmao/docker-in-action-vn/blob/master/1.6.Summary.md#t%C3%B3m-t%E1%BA%AFt) |
