# Loại bỏ hàng loạt xung đột: Xây dựng một website farm

Trong phần cuối bạn đã nhìn thấy như thế nào DOCKER giúp bạn tránh xung đột phần mềm với process isolation. Nhưng nếu bạn không cẩn thận, bạn có thể xây dựng hệ thống với nhiều conflicts, hay những conflics giữa container bên trong DOCKER layer.

Xem xét một ví dụ khác nơi mà một client đã hỏi bạn xây dựng một hệ thống nơi mà bạn có thể host một số lượng biến của website cho khách hàng của họ. Họ cũng thích sử dụng công nghệ monitoring (giám sát) cái mà bạn đã xây dựng dễ dàng trong chương này. Đơn giản bằng việc mở rộng hệ thống bạn đã xây dựng trước đó sẽ là cách đơn giản nhất để hoàn thành công việc này mà không chỉnh sửa cấu hình cho NGINX. Trong ví dụ này bạn sẽ xây dựng một hệ thống với nhiều container chạy web server và một monitoring agent (agent) cho mỗi web seerver. Hệ thống sẽ trong giống như mô tả kiến trúc trong hình 2.2

![](https://github.com/vuongmao/docker-in-action-vn/blob/master/asset/2.4-image-1.png)

Hình 2.2 Một nhóm các web server container và quan hệ với những monitoring agents.

## 2.4.1 Xác định container một cách linh hoạt

Cách tốt nhất để tìm nguyên nhân tại việc tạo ra nhiềm bản copy một các đơn giản của NGINX container mà bạn đã sử dụng trong ví dụ cuối là một ý tưởng tệ để thử nghiệm cho chính bạn:

```
docker run -d --name webid nginx <-- Create a container named "webid"
docker run -d --name webid nginx <-- Create another container named "webid"
```

Command thứ 2 ở đây sẽ xảy ra lỗi với một conflict error:

```
FATA[0000] Error response from daemon: Conflict. The name "webid" is
already in use by container 2b5958ba6a00. You have to delete (or rename)
that container to be able to reuse that name.
```

Sử dụng tên container cố định giống như _web_ rất hữu ích cho thử nghiệm và tài liệu, nhưng trong một hệ thống với nhiều container, sử dụng tên cố định giống như vậy có thể tạo ra conflics. Vì mặc định DOCKER gán một tên duy nhất (human-friendly) cho mỗi container nó tạo. `--name` flag chỉ đơn giản là ghi lại process với một giá trị đã biết. Khi tình huống xuất hiện ở đây tên của một container cần thay đổi, bạn có thể thay đổi tên container với `docker rename` command:

```
docker rename webid webid-old    <-- Rename the current web container to "webid-old"
docker run -d --name webid nginx <-- Create another container named "webid"
```

Thay đổi tên containers có thê giúp giảm bớt conflict tên nhưng nó không làm được gì để tránh vấn đề từ lần đầu tiên. Ngoài names, DOCKER gán một định danh duy nhất đã được để cập trong ví dụ đầu tiên. Nhưng số hex-encode 1024-bit và trong nó giống như vầy

```
7cb5d2b9a7eab87f07182b5bf58936c9947890995b1b94f412912fa822a9ecb5
```

Khi những container được start trong chế độ detached, định danh của chúng sẽ được in ra ngoài terminal. Bạn có thể sử dụng những định dạnh này thay cho tên container với bấy cứ command nào cần chỉ định một container cụ thể. Ví dụ, bạn có thể sử dụng ID trước đó với một `stop` hay `exec` command:

```
docker exec \
    7cb5d2b9a7eab87f07182b5bf58936c9947890995b1b94f412912fa822a9ecb5 \
ps

docker stop \
    7cb5d2b9a7eab87f07182b5bf58936c9947890995b1b94f412912fa822a9ecb5
```
